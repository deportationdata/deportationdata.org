---
Title: "ICE Facilities and Areas of Responsibility"
format: html
toc: false
---

# ICE area of responsibility map

:::{.column-body-outset}

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(sf)
library(sfarrow)

aor_sf <- sfarrow::st_read_feather(
  "https://github.com/deportationdata/ice/raw/refs/heads/ice-offices/data/ice-aor-df.feather"
) |>
  rename(`Area of Responsibility` = `Area.of.Responsibility`)

aor_centroid_coords <-
  aor_sf |>
  st_transform(4326) |>
  st_point_on_surface() |>
  mutate(
    lng = st_coordinates(geometry)[, 1],
    lat = st_coordinates(geometry)[, 2]
  ) |>
  st_drop_geometry()

library(leaflet.extras2)

leaflet() |>
  addProviderTiles(providers$CartoDB.PositronNoLabels) |>
  addPolygons(
    data = aor_sf |> st_transform(4326),
    weight = 1,
    opacity = 1,
    color = gray(0.45),
    fill = NA
  ) |>
  addLabelOnlyMarkers(
    data = aor_centroid_coords,
    lng = ~lng,
    lat = ~lat,
    label = ~`Area of Responsibility`,
    labelOptions = labelOptions(
      noHide = TRUE,
      textOnly = TRUE,
      direction = "center",
      style = list(
        "color" = gray(0.35),
        "font-size" = "12px",
        # "font-weight" = "bold",
        "text-shadow" = "-1px -1px 0 #ffffff, 1px -1px 0 #ffffff, -1px 1px 0 #ffffff, 1px 1px 0 #ffffff"
      )
    ),
    group = "markers"
  ) |>
  setView(lng = -98.5795, lat = 39.8283, zoom = 4)
```

:::


# ICE Field Office Locations

```{r}
library(reactable)

field_office_df <- arrow::read_feather(
  "https://github.com/deportationdata/ice/raw/refs/heads/ice-offices/data/ice-offices.feather"
)

# TODO: add sub-offices as sub-tables under main offices

field_office_df |>
  filter(office_category == "Field office", office_type == "ERO") |>
  mutate(
    Address = glue::glue("{address}, {city}, {state} {zip}")
  ) |>
  select(Office = city, `Coverage area` = area, Address) |>
  reactable(
    pagination = FALSE,
    striped = TRUE,
    # fullWidth = TRUE,
    theme = reactableTheme(
      tableStyle = list(backgroundColor = "transparent"),
      headerStyle = list(backgroundColor = "transparent")
    )
  )
```
